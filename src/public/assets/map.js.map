{"version":3,"sources":["webpack:///webpack/bootstrap 73c6d36b83e524f374cc","webpack:///./src/public/javascript/api.js","webpack:///./src/public/javascript/interactions.js","webpack:///./src/public/javascript/local_settings.js","webpack:///./src/public/javascript/utility.js","webpack:///./src/public/javascript/maps-dashboard.js","webpack:///./src/public/javascript/maps.js"],"names":["queueStats","auth","getAuthString","$","val","params","authorization","response","request","json","getReportResults","type","getReportData","data","parameters","reportType","url","apiURL","API_URL","requestOptions","method","headers","body","JSON","stringify","fetch","then","status","notifyServer504","ok","bodyText","text","Error","statusText","catch","err","error","jsonToReturnValue","getFaultStringFromData","getParameters","requestType","user","pass","document","ready","click","removeClass","addClass","event","preventDefault","message","console","log","newDate","Date","setTime","now","dateString","toTimeString","formatAMPM","date","hours","getHours","minutes","getMinutes","seconds","getSeconds","ampm","strTime","username","password","btoa","timeout","mapSettings","display","callMap","clearTimeout","startUpdatingMap","setupFilterListeners","children","currentTarget","hasClass","change","refreshRate","updateMap","moment","format","setTimeout","reportTimeRange","skills","customerData","getCustomerData","callData","Object","keys","map","zip","zipCode","calls","filter","d","reduce","sum","customers","missing","getZipsWithoutCustomers","concat","field","keyTitle","formatLegend","d3","filterFn","minCustomers","value","keyFn","substring","rollupFn","x","callsPerCustomer","callsByZip","nest","key","rollup","entries","update","customerCount","lastUpdated","isBefore","subtract","rawData","object","item","isZipWithoutCustomers","hasOwnProperty","time","start","tz","end","relativeSelector","isNaN","CallMap","create","colors","width","height","minValue","min","maxValue","max","scaleLinear","domain","extent","rangeRound","color","scaleThreshold","range","path","geoPath","svg","select","attr","drawKey","queue","defer","await","usa","zipData","onReady","drawZips","drawStates","g","remove","exit","selectAll","backgroundColor","sorted","features","sort","a","b","isEmptyZip","properties","ZIP","insert","enter","append","get","o","has","invertExtent","Math","abs","call","axisBottom","tickSize","tickFormat","tickValues"],"mappings":"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","file":"map.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 72);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 73c6d36b83e524f374cc","import { error, getAuthString } from './utility.js';\r\nimport { API_URL } from './local_settings.js';\r\n\r\n////////////////////////////////////////////////////////////////\r\n// Functions to retrieve and extract useful data from Five9.\r\n// These functions interact with our server, which then passes\r\n// requests on to Five9's server.\r\n////////////////////////////////////////////////////////////////\r\n\r\n// Get real-time stats\r\nexport async function queueStats() {\r\n    const auth = getAuthString($('.username').val(), $('.password').val());\r\n    const params = { authorization: auth };\r\n\r\n    const response = await request(params, 'queue-stats');\r\n    return await response.json();\r\n}\r\n\r\n\r\n// Get CSV string of report results from Five9\r\n// ${type}: 'maps' or 'service-level'\r\nexport async function getReportResults(params, type) {\r\n    const auth = getAuthString($('.username').val(), $('.password').val());\r\n    params['authorization'] = auth;\r\n\r\n    const response = await getReportData(params, type);\r\n    const data = await response.json();\r\n    return data;\r\n}\r\n\r\n\r\n// ${reportType} : either 'maps' or 'service-level'\r\nexport async function getReportData(parameters, reportType) {\r\n    return request(parameters, 'reports/' + reportType);\r\n}\r\n\r\n\r\n// Make a request to server with given parameters (from getParameters)\r\nasync function request(parameters, url='statistics') {\r\n    const apiURL = API_URL + url; // defined in api_url.js\r\n\r\n    const requestOptions = {\r\n        method: 'POST',\r\n        headers: {\r\n            'Accept': 'application/json',\r\n            'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(parameters)\r\n    }\r\n\r\n    return fetch(apiURL, requestOptions)\r\n        .then(async (response) => {\r\n            if (response.status == 504) notifyServer504(parameters, url); // debugging\r\n            if (!response.ok) {\r\n                let bodyText = await response.text();\r\n                throw new Error(`Server responded with ${response.status} ${response.statusText}: ${bodyText}`);\r\n            }\r\n            return response;\r\n        }).then((response) => {\r\n            return response;\r\n        }).catch((err) => {\r\n            error(err);\r\n        });\r\n}\r\n\r\nasync function notifyServer504() {\r\n    return fetch(API_URL + 'notify-504');\r\n}\r\n\r\n\r\n// Gets the actual returned value/data out of JSON from the server.\r\nfunction jsonToReturnValue(json, type) {\r\n    return json['env:Envelope']['env:Body'][0]['ns2:'+type+'Response'][0]['return'][0];\r\n}\r\n\r\n// takes JSON from server and returns text within 'faultstring' tag (if existant)\r\nfunction getFaultStringFromData(data) {\r\n    try {\r\n        return data['env:Envelope']['env:Body'][0]['env:Fault'][0]['faultstring'];\r\n    } catch (err) {\r\n        return '';\r\n    }\r\n}\r\n\r\n// Given a requestType, returns JSON to submit to server in POST request.\r\n// requestType should match Five9 API command.\r\nexport function getParameters(requestType) {\r\n    let params = {};\r\n    // Initiate session\r\n    if (requestType == 'setSessionParameters') {\r\n        params = {\r\n            'service': 'setSessionParameters',\r\n            'settings': [ {\r\n                'viewSettings': [\r\n                    { 'idleTimeOut': 1800 },\r\n                    { 'statisticsRange': 'CurrentDay' },\r\n                    { 'rollingPeriod': 'Minutes10' }\r\n                ]\r\n            } ]\r\n        }\r\n    }\r\n    // Get real-time call stats\r\n    if (requestType == 'ACDStatus') {\r\n        params = {\r\n            'service': 'getStatistics',\r\n            'settings': [ {\r\n                'statisticType': 'ACDStatus'\r\n            } ]\r\n        }\r\n    }\r\n\r\n    // Credentials\r\n    let user = $('.username').val();\r\n    let pass = $('.password').val();\r\n    params['authorization'] = getAuthString(user, pass);\r\n\r\n    return params;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/public/javascript/api.js","// Handles UI interaction for login form\r\n\r\n$(document).ready(() => {\r\n    // show Login form\r\n    $('.credentials-cover-toggle').click(() => {\r\n        $('.credentials-form').removeClass('out-of-the-way');\r\n        $('.credentials-cover').addClass('out-of-the-way');\r\n    });\r\n\r\n    // listen for sign-in button press\r\n    $('.begin-session').click(async (event) => {\r\n        // prevent redirection\r\n        event.preventDefault();\r\n        \r\n        // clear Five9 credentials box and update Login button text\r\n        $('.credentials-form').addClass('out-of-the-way');\r\n        $('.credentials-cover').removeClass('out-of-the-way');\r\n        $('.credentials-cover-toggle').text('Logged In');\r\n    });\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/public/javascript/interactions.js","export const API_URL = 'http://localhost:3000/api/';\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/public/javascript/local_settings.js","\r\n// Send out an error alert in console and on the page.\r\nexport function error(err, message='Uh oh.') {\r\n    $('#message').text(`Whoops! An error occurred. ${err.message}. ${message}`);\r\n    console.log('Error log:');\r\n    console.error(err);\r\n\r\n    // timestamp\r\n    let newDate = new Date();\r\n    newDate.setTime(Date.now());\r\n    let dateString = newDate.toTimeString();\r\n    console.log(dateString);\r\n}\r\n\r\n// Nicely formatted time\r\nexport function formatAMPM(date) {\r\n    let hours = date.getHours();\r\n    let minutes = date.getMinutes();\r\n    let seconds = date.getSeconds();\r\n    let ampm = hours >= 12 ? 'PM' : 'AM';\r\n    hours = hours % 12;\r\n    hours = hours ? hours : 12; // the hour '0' should be '12'\r\n    minutes = minutes < 10 ? '0'+minutes : minutes;\r\n    seconds = seconds < 10 ? '0'+seconds : seconds;\r\n    let strTime = hours + ':' + minutes + ':' + seconds + ' ' + ampm;\r\n    return strTime;\r\n}\r\n\r\n\r\n// Combines username and password, then encodes in Base 64. Yum!\r\nexport function getAuthString(username, password) {\r\n   let auth = username + ':' + password;\r\n   return btoa(auth);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/public/javascript/utility.js","import { error } from './utility';\r\nimport * as api from './api';\r\nimport './interactions';\r\nimport CallMap from './maps';\r\n\r\n// General functions to initiate the call map dashboard.\r\n// Uses the CallMap class defined in maps.js to draw the D3 map.\r\n\r\n// timeout to pause event loop when needed\r\nlet timeout = null;\r\nconst mapSettings = {\r\n    display: 'total'\r\n};\r\n\r\n$(document).ready(() => {\r\n    let callMap = new CallMap();\r\n\r\n    // listen for sign-in and update button presses\r\n    $('.begin-session, .filters-wrapper .update').click(async (event) => {\r\n        // stop any current event loops running\r\n        if (timeout != null) {\r\n            clearTimeout(timeout);\r\n        }\r\n        // Update map every 4 minutes\r\n        startUpdatingMap(callMap, 4*60);\r\n    });\r\n\r\n    // Listen for changes to the filter settings\r\n    setupFilterListeners();\r\n});\r\n\r\n\r\nfunction setupFilterListeners() {\r\n    // handle toggle for relative / absolute date filters\r\n    $('.date-type-toggle').children().click((event) => {\r\n        // Relative button was chosen\r\n        if ($(event.currentTarget).hasClass('relative')) {\r\n            // Update toggle buttons to show current selection\r\n            $('.date-type-toggle .relative').addClass('checked');\r\n            $('.date-type-toggle .absolute').removeClass('checked');\r\n            // Display the appropriate date selection\r\n            $('.date-filter-inputs.absolute').addClass('hidden');\r\n            $('.date-filter-inputs.relative').removeClass('hidden');\r\n        // Absolute button was clicked\r\n        } else {\r\n            $('.date-type-toggle .absolute').addClass('checked');\r\n            $('.date-type-toggle .relative').removeClass('checked');\r\n            $('.date-filter-inputs.relative').addClass('hidden');\r\n            $('.date-filter-inputs.absolute').removeClass('hidden');\r\n        }\r\n    })\r\n\r\n    // Handle selection of Today vs Last X Minutes for relative filters\r\n    $('.relative-date-selector').change(() => {\r\n        if ($('.relative-date-selector').val() == 'last-x-minutes') {\r\n            $('.relative-parameters-wrapper').removeClass('hidden');\r\n        } else {\r\n            $('.relative-parameters-wrapper').addClass('hidden');\r\n        }\r\n    });\r\n\r\n    // Alternate between mapping total calls or calls per customer count\r\n    $('.call-display-toggle').children().click((event) => {\r\n        // Was Total button clicked?\r\n        if ($(event.currentTarget).hasClass('total')) {\r\n            mapSettings.display = 'total';\r\n            $('.call-display-toggle .total').addClass('checked');\r\n            $('.call-display-toggle .relative').removeClass('checked');\r\n            // show minimum customer filter\r\n            $('.call-display .minimum-customers-wrapper').addClass('hidden');\r\n        // Relative display was chosen\r\n        } else {\r\n            mapSettings.display = 'relative';\r\n            $('.call-display-toggle .total').removeClass('checked');\r\n            $('.call-display-toggle .relative').addClass('checked');\r\n            $('.call-display .minimum-customers-wrapper').removeClass('hidden');\r\n        }\r\n    });\r\n}\r\n\r\n// Begins a loop of updating the map data every ${refreshRate} seconds\r\nasync function startUpdatingMap(callMap, refreshRate) {\r\n    try {\r\n        $('.message').text(`Updating...`);\r\n        await updateMap(callMap);\r\n        $('.message').text('Last updated ' + moment().format('h:mm:ss A') + '.');\r\n    } catch (err) {\r\n        error(err);\r\n    }\r\n    timeout = setTimeout(() => startUpdatingMap(callMap, refreshRate),\r\n                         refreshRate * 1000);\r\n}\r\n\r\n// Update callMap (d3 map object) based on parameters in page\r\nasync function updateMap(callMap) {\r\n    const params = reportTimeRange();\r\n    params.skills = $('.skills.filter').val();\r\n\r\n    // get all the datas\r\n    let customerData = await getCustomerData();\r\n    const callData = await api.getReportResults(params, 'maps');\r\n\r\n    // build data object off of customerData zip codes\r\n    let data = Object.keys(customerData)\r\n        .map((zip) => ({\r\n            zipCode: zip,\r\n            calls: callData\r\n                    .filter((d) => d.zipCode == zip)\r\n                    .reduce((sum, d) => sum + d.calls, 0),\r\n            customers: customerData[zip]\r\n        }));\r\n\r\n    // if any zips with calls are missing from customerData, add them here\r\n    let missing = getZipsWithoutCustomers(callData, customerData);\r\n    data.concat(missing);\r\n\r\n    // Determine the field being mapped -- total calls or per customer\r\n    let field;\r\n    if (mapSettings.display == 'total') {\r\n        field = 'calls';\r\n        callMap.keyTitle = 'Calls offered';\r\n        callMap.formatLegend = d3.format('d');\r\n    } else if (mapSettings.display == 'relative') {\r\n        field = 'callsPerCustomer';\r\n        callMap.keyTitle = 'Calls offered divided by customer base';\r\n        callMap.formatLegend = d3.format('.1%');\r\n    }\r\n\r\n    // If we're in relative display mode, the user can filter areas meeting a\r\n    // minimum customer count\r\n    let filterFn;\r\n    if (mapSettings.display == 'relative') {\r\n        let minCustomers = $('.minimum-customers').val() * 1;\r\n        filterFn = (d) => d.value.customers >= minCustomers;\r\n    } else {\r\n        filterFn = (d) => true;\r\n    }\r\n\r\n    // Key and value extractor functions\r\n    const keyFn = (d) => d.zipCode.substring(0, 3);\r\n    const rollupFn = (d) => {\r\n        let calls = d3.sum(d, (x) => x.calls);\r\n        let customers = d3.sum(d, (x) => x.customers);\r\n        let callsPerCustomer;\r\n        if (customers == 0) callsPerCustomer = 0;\r\n        else callsPerCustomer = calls / customers;\r\n        return {\r\n            'calls': calls,\r\n            'customers': customers,\r\n            'callsPerCustomer': callsPerCustomer\r\n        }\r\n    }\r\n\r\n    // Create the data structure in a D3-friendly way\r\n    let callsByZip = d3.nest()\r\n        .key(keyFn)\r\n        .rollup(rollupFn)\r\n        .entries(data)\r\n        .filter(filterFn)\r\n        .filter((d) => d.key != ''); // remove calls with no zipcode assigned\r\n\r\n    callMap.update(callsByZip, field, keyFn, rollupFn);\r\n\r\n    console.log('Finished updateMap() at ' + moment().format('h:mm:ss A'));\r\n}\r\n\r\n// Object to store customer zipcode data.\r\nconst customerCount = {\r\n    data: [],\r\n    // record time of last update (default to Y2K to force an update)\r\n    lastUpdated: moment('2000-01-01')\r\n};\r\n/**\r\n * Retrieve customer counts by zip code. Updates from the server every 6 hours.\r\n * @return {Object} in format { '<zip code here>': '31415' }\r\n */\r\nasync function getCustomerData() {\r\n    // reload data from server if it's been 6+ hours since the last update\r\n    if (customerCount.lastUpdated.isBefore(moment().subtract(6, 'hours'))) {\r\n        let rawData = await api.getReportResults({}, 'customers');\r\n\r\n        // Convert array of objects to a single object, with zipcode as key\r\n        // and customer count as volue\r\n        customerCount.data = rawData.reduce((object, item) => {\r\n            object[item.zipCode] = item.customerCount;\r\n            return object;\r\n        }, {});\r\n\r\n        customerCount.lastUpdated = moment();\r\n    }\r\n    return customerCount.data;\r\n}\r\n\r\n\r\nfunction getZipsWithoutCustomers(callData, customerData) {\r\n    callData\r\n        .filter((d) => isZipWithoutCustomers(d.zipCode, customerData))\r\n        .map((d) => ({\r\n            zipCode: d.zipCode,\r\n            calls: d.calls,\r\n            customers: 0\r\n        }));\r\n}\r\n\r\nfunction isZipWithoutCustomers(zip, customerData) {\r\n    return (zip != '' && !customerData.hasOwnProperty(zip));\r\n}\r\n\r\n// Determines start/end times chosen by user\r\n// Return {start:'X',end:'Y'}\r\nfunction reportTimeRange() {\r\n    const time = {};\r\n    // Are we using absolute dates?\r\n    if ($('.date-type-toggle .absolute').hasClass('checked')) {\r\n        time.start = moment($('.filter.start-time').val())\r\n                        .tz('America/Los_Angeles')\r\n                        .format('YYYY-MM-DD[T]HH:mm:ss');\r\n        time.end   = moment($('.filter.end-time'  ).val())\r\n                        .tz('America/Los_Angeles')\r\n                        .format('YYYY-MM-DD[T]HH:mm:ss');\r\n    // Using relative dates\r\n    } else {\r\n        const relativeSelector = $('.relative-date-selector').val();\r\n        if (relativeSelector == 'today') {\r\n            time.start = moment().format('YYYY-MM-DD') + 'T00:00:00';\r\n            time.end   = moment().format('YYYY-MM-DD') + 'T23:59:59';\r\n        // If user specified a certain number of minutes, subtract the minutes,\r\n        // convert to Eastern Time, and round down to nearest 30-minute interval\r\n        } else if (relativeSelector == 'last-x-minutes') {\r\n            const minutes = $('.filter.relative-minutes').val();\r\n            if (isNaN(minutes)) throw new Error(`Relative minute value ${minutes} is not a number.`);\r\n            // Convert to server's timezone\r\n            let start = moment().subtract(minutes, 'm').tz('America/Los_Angeles');\r\n            // round down to nearest interval\r\n            start.subtract(start.minutes() % 30, 'minutes');\r\n            start.seconds(0);\r\n            time.start = start.format('YYYY-MM-DD[T]HH:mm:ss');\r\n            console.log(time.start);\r\n            time.end   = moment().format('YYYY-MM-DD') + 'T23:59:59';\r\n        } else {\r\n            throw new Error('Relative date selector value is ' + relativeSelector +\r\n                            '. Value not recognized.');\r\n        }\r\n    }\r\n    return time;\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/public/javascript/maps-dashboard.js","import { API_URL } from './local_settings';\r\n\r\n// Map of U.S. with ZIP3 areas colored by calls offered.\r\n// Offers methods to create/draw the map and update when new data is received.\r\nexport default class CallMap {\r\n    /**\r\n     * Create and draw map on initial run\r\n     * @param  {Object}  data d3.nest data object with zipcode as key and fields as values\r\n     * @param  {String}  field to map (calls or callsPerCustomer)\r\n     * @return {Promise} resolves when complete\r\n     */\r\n    create(data, field) {\r\n        // Taken from d3.schemeBlues[9]\r\n        this.colors = [\"#f7fbff\", \"#deebf7\", \"#c6dbef\", \"#9ecae1\", \"#6baed6\", \"#4292c6\", \"#2171b5\", \"#08519c\", \"#08306b\"];\r\n\r\n        let width = 960,\r\n            height = 500;\r\n\r\n        this.calls = d3.map(data, (d) => d.key);\r\n        let minValue = d3.min(data, (d) => d.value[field]);\r\n        let maxValue = d3.max(data, (d) => d.value[field]);\r\n\r\n        this.x = d3.scaleLinear()\r\n            .domain(d3.extent(data, (d) => d.value[field]))\r\n            .rangeRound([600, 860]);\r\n\r\n        this.color = d3.scaleThreshold()\r\n            .domain(d3.range(0, maxValue, maxValue / 9))\r\n            .range(this.colors);\r\n\r\n        this.path = d3.geoPath();\r\n\r\n        this.svg = d3.select('svg')\r\n            .attr('width', width)\r\n            .attr('height', height);\r\n\r\n        // Key / legend\r\n        this.keyTitle = 'Calls offered';\r\n        this.drawKey(this.x, this.color);\r\n\r\n        return d3.queue()\r\n            .defer(d3.json, API_URL + 'states')\r\n            .defer(d3.json, API_URL + 'zip3-data')\r\n            .await((err, usa, zipData) => this.onReady(err, usa, zipData, field));\r\n    }\r\n\r\n    // Assign initial variables when map is first created and topographic\r\n    // data is first loaded\r\n    onReady(err, usa, zipData, field) {\r\n        this.zipData = zipData;\r\n        this.usa = usa;\r\n        this.drawZips(zipData, field);\r\n        this.drawStates(usa);\r\n    }\r\n\r\n    // Update map with new data\r\n    async update(data, field) {\r\n        // Check if this chart already exists. If not, create it.\r\n        if (!this.svg) return this.create(data, field);\r\n\r\n        // match calls to keys (zip codes)\r\n        this.calls = d3.map(data, (d) => d.key);\r\n\r\n        // update domain and range\r\n        let max = d3.max(data, (d) => d.value[field]);\r\n        this.x.domain(d3.extent(data, (d) => d.value[field]));\r\n        this.color.domain(d3.range(0, max, max / 9));\r\n\r\n        // Key / legend\r\n        // remove then redraw the color key\r\n        this.g.remove().exit();\r\n        this.drawKey(this.x, this.color);\r\n\r\n        // data - paint the state lines and zip codes\r\n        // clear old states and zips\r\n        this.svg.selectAll('.zips, .states').remove().exit();\r\n        // then rebuild them\r\n        this.drawZips(this.zipData, field);\r\n        this.drawStates(this.usa);\r\n    }\r\n\r\n    // Draw ZIP3 areas, colored by number of calls\r\n    // ${zipData} is GeoJSON describing the topography\r\n    drawZips(zipData, field) {\r\n        let backgroundColor = '#feffff';\r\n        // Sort so that areas with call data are drawn last and end up on top\r\n        let sorted = zipData.features.sort((a, b) => {\r\n            if (this.isEmptyZip(a.properties.ZIP, field)) return -1;\r\n            return 1;\r\n        });\r\n\r\n        this.svg.insert('g', '.key')\r\n            .attr('class', 'zips')\r\n          .selectAll('path')\r\n          .data(sorted)\r\n          .enter().append('path')\r\n            .attr('d', this.path)\r\n            .attr('fill', (d) => {\r\n                let zip = d.properties.ZIP;\r\n                if (this.isEmptyZip(zip, field)) return backgroundColor;\r\n                return this.color(this.calls.get(zip).value[field]);\r\n            })\r\n            .attr('stroke', (d) => {\r\n                let zip = d.properties.ZIP;\r\n                if (this.isEmptyZip(zip, field)) return backgroundColor;\r\n                return 'hsla(208, 30%, 60%, 0.5)';\r\n            })\r\n          .append('title')\r\n            .text((d) => {\r\n                let zip = d.properties.ZIP;\r\n                let o = { calls: 0, customers: 0, callsPerCustomer: 0 };\r\n                if (this.calls.has(zip)) {\r\n                    o = this.calls.get(zip).value;\r\n                }\r\n                return `ZIP3: ${zip}\\nCalls: ${o.calls}\\nCustomers: ${o.customers}\\nCalls divided by customer count: ${d3.format(\".2%\")(o.callsPerCustomer)}`;\r\n            });\r\n    }\r\n\r\n    /**\r\n     * Returns true if the zip code is not in the data or has a value equal to 0\r\n     * @param  {String}  zip   zip code\r\n     * @param  {String}  field to check in this.calls.value\r\n     * @return {Boolean}\r\n     */\r\n    isEmptyZip(zip, field) {\r\n        return (!this.calls.has(zip) || this.calls.get(zip).value[field] == 0);\r\n    }\r\n\r\n    // Draw the state outlines\r\n    drawStates(usa) {\r\n        this.svg.insert('g', '.key')\r\n            .attr('class', 'states')\r\n          .selectAll('path')\r\n          .data(usa.features)\r\n          .enter().append('path')\r\n            .attr('d', this.path);\r\n    }\r\n\r\n    // Draw the key/legend\r\n    drawKey(x, color) {\r\n        this.g = this.svg.append('g')\r\n            .attr('class', 'key')\r\n            .attr('transform', 'translate(0,40)');\r\n        this.g.selectAll('rect')\r\n            .data(color.range().map((d) => {\r\n                d = color.invertExtent(d);\r\n                if (d[0] == null) d[0] = x.domain()[0];\r\n                if (d[1] == null) d[1] = x.domain()[1];\r\n                return d;\r\n            }))\r\n            .enter().append('rect')\r\n              .attr('height', 8)\r\n              .attr('x', (d) => x(d[0]))\r\n              .attr('width', (d) => {\r\n                  return Math.abs(x(d[1]) - x(d[0]));\r\n              } )\r\n              .attr('fill', (d) => color(d[0]));\r\n\r\n        this.g.append('text')\r\n            .attr('class', 'caption')\r\n            .attr('x', x.range()[0])\r\n            .attr('y', -6)\r\n            .attr('fill', '#444')\r\n            .attr('text-anchor', 'start')\r\n            .attr('font-weight', 'bold')\r\n            .text(this.keyTitle);\r\n          this.g.call(d3.axisBottom(x)\r\n            .tickSize(13)\r\n            .tickFormat(this.formatLegend)\r\n            .tickValues(color.domain()))\r\n          .select('.domain')\r\n            .remove();\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/public/javascript/maps.js"],"sourceRoot":""}